#!/usr/bin/env bash
set -e

echo "Running pre-commit hooks..."

# Rust formatting — auto-fix and re-stage
if command -v cargo &>/dev/null; then
    echo "  Formatting Rust files..."
    cargo fmt
    git diff --name-only --cached -- '*.rs' | xargs -r git add
else
    echo "  WARNING: cargo not found, skipping Rust formatting"
fi

# Prettier — auto-fix and re-stage
if command -v npx &>/dev/null; then
    echo "  Formatting with Prettier..."
    npx --yes prettier --write '**/*.{yml,yaml,md,json}' 2>/dev/null
    git diff --name-only --cached -- '*.yml' '*.yaml' '*.md' '*.json' | xargs -r git add
else
    echo "  WARNING: npx not found, skipping Prettier formatting"
fi

echo "All formatted and staged."
